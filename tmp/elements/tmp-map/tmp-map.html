<dom-module id="tmp-map">
	<!--COPYRIGHT 2015 Sebastian Schneider & Dennis Kugelmann, all rights reserved -->
	<template>
		<style>
		section {
			height: 100%;
			width: 100%;
			background-color: #EEEEEE;
			margin: auto;
		}

		map {
			height: 100%;
			width: 100%;
			position: absolute;
		}
		.border {
			box-sizing: border-box;
			position: absolute;
			border: 1px dotted #555; /*debug*/
		}
		.btop{
			border-top: 5px solid black;
		}
		.bright{
			border-right: 4px solid black;
		}
		.bbottom{
			border-bottom: 4px solid black;
		}
		.bleft{
			border-left: 4px solid black;
		}
		.red{
			background-color: red;
		}
		</style>
		<section>
			<map></map>
		</section>
	</template>
	<script src="../../js/main.js"></script>
	<script type="text/javascript">
		Polymer({
			is: 'tmp-map',

			attached: function(){
				generateMap(20);
				mapTo_16_9();
			}
		});

		var blocks = [];

		function runLabAlgor(x, y){
			//pick random start at border
			var curBl = "";
			var cx = getRandomInt(0, x - 1);
			var cy = getRandomInt(0, y - 1);
			var run = true;
			var count = 0;

			$("#border" + cx + cy).addClass("red");

			while(run){
				var newB = newBlock(x, y, cx, cy);

				$("#border" + newB["x"] + "_" + newB["y"]).addClass("red");

				cx = newB["x"];
				cy = newB["y"];

				if(count == 2500){run = false;}
				count++;
			}
			
		}
		function drawMap(json){
			var mpblocks = ((json == undefined) ? blocks : JSON.parse(json));

			for(var i = 0; i < mpblocks.length; i++){
				for(var j = 0; j < mpblocks[i].length; j++){
					var bl = mpblocks[i][j];

					if(bl[1]){
						$("#border" + i + "_" + j).addClass("btop");
					}
					if(bl[4]){
						$("#border" + i + "_" + j).addClass("bleft");
					}
				}
			}
		}
		function generateMap(bh){
			var blockHori = ((bh == undefined) ? getRandomInt(8, 25) : bh);
			var blockVerti = parseInt((blockHori / 16) * 9); //16 : 9
			var borderStr = 4;

			var posx = 0;
			var posy = 0;
			var hx = 100 / blockHori
			var hy = 100 / blockVerti;
			var mgtop = 0;
			var mgleft = 0;

			var mapc = "";
			
				for(var i = 0; i < blockHori; i++){
				    blocks[i] = [];
				    for(var j = 0; j < blockVerti; j++){
				    	mapc += "" 
				    	+ "<div id='border" + i + "_" + j +"' style='height: " + hy 
				    	+ "%; width: " + hx
				    	+ "%; top: calc(" + posy 
				    	+ "% + " + ((blockVerti * borderStr) / 2 - 5) + "px); left: calc(" + posx 
				    	+ "% + " + ((blockHori * borderStr) / 2) + "px); margin-top: -" + mgtop
				    	+ "px; margin-left: -" + mgleft
				    	+ "px;' class='tmp-map border ";
				       	
				    	blocks[i][j] = [];

				        blocks[i][j][0] = null;
				        blocks[i][j][1] = true;
				        blocks[i][j][2] = null;
				        blocks[i][j][3] = null;
				        blocks[i][j][4] = true;


				        if(j == 0){
				        	mapc += "btop ";
				        	blocks[i][j][1] = true;
				        } 
				        if(i == blockHori - 1){
				        	mapc += "bright ";
				        	blocks[i][j][2] = true;
				        }
				        if(j == blockVerti - 1){
				        	mapc += "bbottom ";
				        	blocks[i][j][3] = true;
				        }
				        if(i == 0){
				        	mapc += "bleft ";
				        	blocks[i][j][4] = true;
				        }
				        mapc += "'></div>"
				        posy = posy + 100 / blockVerti;
				        mgtop = mgtop + borderStr;
				    }
				    posy = 0;
				    mgtop = 0;
				    mgleft = mgleft + borderStr;
				    posx = posx + 100 / blockHori;
				}

				$("map").html(mapc);
				drawMap(runLabAlgor(blockHori, blockVerti));
		}
		function mapTo_16_9(){
			if(((window.innerWidth / 16) * 9) < window.outerHeight){
				$("map").height(((window.innerWidth / 16 ) * 9));
				$("map").css("top", (window.outerHeight - ((window.innerWidth / 16) * 9)) / 3); 
			}
			if(((window.outerHeight / 9) * 16) < window.innerWidth){
				$("map").width(((window.outerHeight / 9 ) * 16));
				$("map").css("left", (window.innerWidth - ((window.outerHeight / 9) * 16)) / 2);
			}
		}
		function newBlock(x, y, cx, cy){
			var returner = [];
			var ny = cy;
			var nx = cx;

			switch(getRandomInt(0, 3)){
				case 0: ny = cy - 1; break;
				case 1: nx = cx + 1; break;
				case 2: ny = cy + 1; break;
				case 3: nx = cx - 1; break;
			}

			if(nx < 0 || nx >= x || ny < 0 || ny >= y){
				return newBlock(x, y, cx, cy);
			}
			else{
				l(nx + " " + ny);
				blocks[nx][ny][0] = true;
				returner["x"] = nx;
				returner["y"] = ny;
				return returner;
			}
		}
	</script>
</dom-module>  