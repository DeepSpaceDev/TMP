<dom-module id="tmp-tank">
	<template>
		<style>
			:host {
				display: block;
				position: absolute;
			}
			.tank{
				height: 25px;
				width: 25px;
				background-color: grey;
			}
		</style>
	<section>
		<div class="tank"></div>
	</section>
	</template>
	<script>
		Polymer({
			is: 'tmp-tank',

			attached: function(){
				regKeyListener(this.id);
			}
		});

		function regKeyListener(id){
			var forward, backward, right, left;
			var rot;

			var interlenght = 10;

			window.onkeydown = function(e) {
   				var key = e.keyCode ? e.keyCode : e.which;
   				if(key == 83 && !backward){
   					backward = setInterval(function(){
   						move("backward", id);
   					}, interlenght);
   				}
   				if(key == 87 && !forward){
   					forward = setInterval(function(){
   						move("forward", id);
   					}, interlenght);
   				}
				if(key == 68 && !right){
					right = setInterval(function(){
					 	rotate("right", id);
					 }, interlenght);
				}
   				if(key == 65 && !left){
   					left = setInterval(function(){
   					 	rotate("left", id);
   					 }, interlenght);
   				}				
   			}
   			window.onkeyup = function(e){
   				var key = e.keyCode ? e.keyCode : e.which;
   				if(key == 83){
   					clearInterval(backward);
   					backward = null;
   				}
   				if(key == 87){
   					clearInterval(forward);
   					forward = null;
   				}
   				if(key == 68){
   					clearInterval(right);
   					right = null;
   				}
   				if(key == 65){
   					clearInterval(left);
   					left = null;
   				}
   			}
		}
		function move(type, id){
			var ctop = ((document.querySelector("#" + id).style.top == "") ? 0 : parseFloat(document.querySelector("#" + id).style.top.replace("px", "")));
			var cleft =  ((document.querySelector("#" + id).style.left == "") ? 0 : parseFloat(document.querySelector("#" + id).style.left.replace("px", "")));
			var tmove = 0;
			var lmove = 0;
			var rotation = getRotation($("#" + id)) * (Math.PI/180);
			var movespeed = (100 / blocks.length) / 5.3; //best value

			if(type == "forward"){
				lmove = Math.sin(rotation) * movespeed				
				tmove = Math.cos(rotation) * -1 * movespeed;
			}
			else if(type == "backward"){
				lmove = Math.sin(rotation) * -1 * movespeed				
				tmove = Math.cos(rotation) * movespeed;
			}
			document.querySelector("#" + id).style.top = (ctop + tmove) + "px";
			document.querySelector("#" + id).style.left = (cleft + lmove) + "px";
		}
		function rotate(type, id){
			var rotspeed = 2.2;
			var crotate = getRotation($("#" + id));
			var nrotate = crotate;
			if(type == "right"){
				nrotate = nrotate + rotspeed;
			}
			else if(type == "left"){
				nrotate = nrotate - rotspeed;
			}
			document.querySelector("#" + id).style.transform = "rotate(" + nrotate + "deg)";
		}
	</script>
</dom-module>