<dom-module id="tmp-game">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
				background: #FAFAFA;
			}
			div {
			}
		</style>
		<div id="mapContainer" style="visibility: collapse">
			<tmp-map></tmp-map>
		</div>
		<div id="menuContainer" style="visibility: visible">
			<tmp-menu on-start-global-game="startGlobalGame"></tmp-menu>
		</div>
		<tmp-game-data data="{{gameData}}"></tmp-game-data>
	</template>
	<script>
		Polymer({
			is: 'tmp-game',

			properties: {
				gameRunning: {
					type: Boolean,
					notify: true,
					value: true,
					observer: '_gameStatusChanged'
				},
				gameData: {
					notify: true
				},
				gameId: {
					type: String
				}
			},

			listeners: {
				'map-ready': '_uploadJSON'
			},

			startGlobalGame: function(e) {
				this.set('gameRunning', true);

				$("map").html("");
				generateMap(e.detail.width);

				var gameId = generateGameId(6);
				this.set('gameId', gameId);

				this.push('gameData', {
					gameId: gameId,
					maxPlayers: e.detail.maxPlayers
				});
			},

			_gameStatusChanged: function(){
				if(this.gameRunning) {
					this.$.mapContainer.style.visibility = 'visible';
					this.$.menuContainer.style.visibility = 'collapse';
				} else {
					this.$.menuContainer.style.visibility = 'visible';
					this.$.mapContainer.style.visibility = 'collapse';
				}
			},

			_uploadJSON: function() {
				for (var i = 0; i < this.gameData.length; i++) {
					if(this.gameData[i].gameId === this.gameId) {
						var game = this.gameData[i];
						game.map = JSON.stringify(blocks);
						this.splice('gameData', i, 1, game);
					}
				};
			}
		});
	</script>
</dom-module>